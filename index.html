<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Developer Experience Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #43e97b;
            --warning: #f5576c;
            --dark: #2c3e50;
            --light: #7f8c8d;
            --bg-light: #f8f9fa;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --shadow-hover: 0 15px 40px rgba(0,0,0,0.15);
            --radius: 15px;
            --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
            position: relative;
        }

        .header h1 {
            font-size: clamp(2rem, 4vw, 3rem);
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header p { font-size: 1.2rem; opacity: 0.9; margin-bottom: 25px; }

        .filters-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .filter-label { font-size: 0.9rem; font-weight: 500; opacity: 0.8; }

        select, input {
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            min-width: 180px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.25);
        }

        select option { background: var(--dark); color: white; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-hover);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-number {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            line-height: 1;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--light);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .stat-trend {
            margin-top: 15px;
            font-size: 0.9rem;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 500;
        }

        .trend-positive { background: rgba(67, 233, 123, 0.1); color: var(--success); }
        .trend-negative { background: rgba(245, 87, 108, 0.1); color: var(--warning); }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: white;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--accent);
            border-radius: 2px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }

        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--dark);
        }

        .chart-subtitle {
            font-size: 0.9rem;
            color: var(--light);
            margin-top: 5px;
        }

        .chart-actions { display: flex; gap: 10px; }

        .chart-action-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            background: var(--bg-light);
            color: var(--dark);
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .chart-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .chart-wrapper { position: relative; height: 350px; }
        .chart-large { grid-column: span 2; }
        .chart-large .chart-wrapper { height: 400px; }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            padding: 100px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: linear-gradient(135deg, var(--warning), #e74c3c);
            color: white;
            padding: 30px;
            border-radius: var(--radius);
            text-align: center;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .error h3 { margin-bottom: 15px; font-size: 1.3rem; }

        .summary {
            background: white;
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success), var(--accent));
        }

        .summary h2 {
            color: var(--primary);
            margin-bottom: 30px;
            font-size: 2rem;
            font-weight: 700;
            text-align: center;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .summary-item {
            padding: 25px;
            background: linear-gradient(135deg, var(--bg-light), #ffffff);
            border-radius: 12px;
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .summary-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .summary-item h3 {
            color: var(--dark);
            margin-bottom: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .summary-item p {
            color: var(--light);
            line-height: 1.7;
            font-size: 1rem;
        }

        .insights-section {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 30px;
            margin: 40px 0;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .insights-title {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .insight-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            text-align: center;
        }

        .insight-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .insight-label { font-size: 0.9rem; opacity: 0.8; }

        .export-section { text-align: center; margin: 40px 0; }

        .export-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, var(--success), var(--accent));
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin: 0 10px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .no-data {
            text-align: center;
            padding: 60px;
            color: var(--light);
        }

        .no-data-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .cta-section {
            background: linear-gradient(135deg, var(--success), var(--accent));
            padding: 60px 40px;
            border-radius: var(--radius);
            text-align: center;
            margin: 50px 0 30px 0;
            box-shadow: var(--shadow);
        }

        .cta-content h2 {
            color: white;
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .cta-content p {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .cta-btn {
            display: inline-block;
            padding: 18px 40px;
            background: white;
            color: var(--success);
            text-decoration: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            transition: var(--transition);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }

        .cta-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .footer {
            background: rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .footer-content {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .footer-content p {
            color: white;
            font-size: 1rem;
            margin: 0;
            text-align: center;
            line-height: 1.6;
        }

        .author-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            border-bottom: 1px solid transparent;
        }

        .author-link:hover {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .charts-grid { grid-template-columns: 1fr; }
            .chart-large { grid-column: span 1; }
            .chart-wrapper, .chart-large .chart-wrapper { height: 280px; }
            .header h1 { font-size: 2rem; }
            .filters-container { flex-direction: column; align-items: center; }
            select, input { min-width: 250px; }
            .cta-content h2 { font-size: 1.8rem; }
            .footer-content p { font-size: 0.9rem; }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>🚀 Developer Experience Dashboard</h1>
        <p>Analisi in tempo reale della soddisfazione degli sviluppatori</p>

        <div class="filters-container">
            <div class="filter-group">
                <span class="filter-label">Anno</span>
                <select id="yearFilter">
                    <option value="all">🌐 Tutti gli anni</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Ruolo</span>
                <select id="roleFilter">
                    <option value="all">👥 Tutti i ruoli</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Esperienza</span>
                <select id="experienceFilter">
                    <option value="all">⏱️ Tutti i livelli</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Ricerca</span>
                <input type="text" id="searchFilter" placeholder="🔍 Cerca..." />
            </div>
        </div>
    </div>

    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div>Caricamento dati dal Google Sheets...</div>
        <div style="font-size: 0.9rem; opacity: 0.7;">Elaborazione analytics in corso</div>
    </div>

    <div id="error" class="error" style="display: none;">
        <h3>⚠️ Errore di Connessione</h3>
        <p>Impossibile caricare i dati. Verifica che il CSV sia pubblicamente accessibile.</p>
        <button onclick="initDashboard()" style="margin-top: 15px; padding: 10px 20px; background: white; color: var(--warning); border: none; border-radius: 20px; cursor: pointer;">🔄 Riprova</button>
    </div>

    <div id="dashboard" style="display: none;">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-number" id="totalResponses">0</div>
                <div class="stat-label">Risposte Totali</div>
                <div class="stat-trend trend-positive" id="responsesTrend">Dataset attivo</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">⭐</div>
                <div class="stat-number" id="avgSatisfaction">0</div>
                <div class="stat-label">Soddisfazione Media</div>
                <div class="stat-trend" id="satisfactionTrend">Su scala 1-5</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🧠</div>
                <div class="stat-number" id="devexAwareness">0%</div>
                <div class="stat-label">Conosce DevEx</div>
                <div class="stat-trend trend-positive" id="awarenessTrend">Consapevolezza</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">💼</div>
                <div class="stat-number" id="companyInvestment">0%</div>
                <div class="stat-label">Aziende Investono</div>
                <div class="stat-trend" id="investmentTrend">Budget dedicato</div>
            </div>
        </div>

        <!-- Insights Section -->
        <div class="insights-section">
            <h3 class="insights-title">📈 Insights Automatici</h3>
            <div class="insights-grid" id="insightsContainer">
                <!-- Generati dinamicamente -->
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-section">
            <h2 class="section-title">Analisi Dati</h2>

            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Distribuzione per Ruolo</div>
                            <div class="chart-subtitle">Composizione del team</div>
                        </div>
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="downloadChart('roleChart')">📥</button>
                            <button class="chart-action-btn" onclick="toggleChartType('roleChart')">🔄</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="roleChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Livelli di Esperienza</div>
                            <div class="chart-subtitle">Distribuzione seniority</div>
                        </div>
                        <div class="chart-actions">
                            <button class="chart-action-btn" onclick="downloadChart('experienceChart')">📥</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="experienceChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Soddisfazione Strumenti</div>
                            <div class="chart-subtitle">Distribuzione punteggi 1-5</div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="satisfactionChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Conoscenza DevEx</div>
                            <div class="chart-subtitle">Livelli di awareness</div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="devexKnowledgeChart"></canvas>
                    </div>
                </div>

                <div class="chart-container chart-large">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Trend Soddisfazione nel Tempo</div>
                            <div class="chart-subtitle">Evoluzione e volume risposte</div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="yearlyTrendChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Soddisfazione per Ruolo</div>
                            <div class="chart-subtitle">Media per categoria</div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="satisfactionByRoleChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Investimento Aziendale</div>
                            <div class="chart-subtitle">Priorità e budget</div>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="companyInvestmentChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="summary">
            <h2>📋 Sintesi Esecutiva</h2>
            <div class="summary-grid" id="summaryContent">
                <!-- Contenuto generato dinamicamente -->
            </div>
        </div>

        <!-- Call to Action Section -->
        <div class="cta-section">
            <div class="cta-content">
                <h2>🚀 Porta la Developer Experience nella tua azienda</h2>
                <p>Sei interessato a migliorare la produttività e la soddisfazione del tuo team di sviluppo?</p>
                <a href="https://calendar.yafb.net/" target="_blank" class="cta-btn">
                    📅 Prenota un appuntamento gratuito
                </a>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <p>© 2025 <a href="https://www.linkedin.com/in/yafb/" target="_blank" class="author-link">Francesco Bianco</a> - Progetto per la diffusione della cultura della Developer Experience</p>
            </div>
        </footer>
    </div>
</div>

<script>
    // Configurazione
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/1mcH4SlJU55BHwvimaVSHG-9B_tY0J2O5uxsuAi-n5eg/export?format=csv';
    const CACHE_DURATION = 10 * 60 * 1000; // 10 minuti in millisecondi
    const CACHE_KEY = 'devex_dashboard_data';
    const CACHE_TIMESTAMP_KEY = 'devex_dashboard_timestamp';

    // Stato globale
    let chartInstances = {};
    let allData = [];
    let filteredData = [];
    let currentFilters = { year: 'all', role: 'all', experience: 'all', search: '' };

    // Colori per i grafici
    const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'];

    // Sistema di cache
    function isLocalhost() {
        return window.location.hostname === 'localhost' ||
            window.location.hostname === '127.0.0.1' ||
            window.location.hostname === '';
    }

    function shouldUseCache() {
        return !isLocalhost();
    }

    function getCachedData() {
        if (!shouldUseCache()) return null;

        try {
            const cachedData = localStorage.getItem(CACHE_KEY);
            const cachedTimestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);

            if (!cachedData || !cachedTimestamp) return null;

            const now = Date.now();
            const cacheAge = now - parseInt(cachedTimestamp);

            if (cacheAge > CACHE_DURATION) {
                // Cache scaduta
                localStorage.removeItem(CACHE_KEY);
                localStorage.removeItem(CACHE_TIMESTAMP_KEY);
                return null;
            }

            console.log(`✅ Utilizzando dati dalla cache (età: ${Math.round(cacheAge / 1000)}s)`);
            return JSON.parse(cachedData);

        } catch (error) {
            console.warn('Errore nel recupero della cache:', error);
            return null;
        }
    }

    function setCachedData(data) {
        if (!shouldUseCache()) return;

        try {
            localStorage.setItem(CACHE_KEY, JSON.stringify(data));
            localStorage.setItem(CACHE_TIMESTAMP_KEY, Date.now().toString());
            console.log(`💾 Dati salvati nella cache`);
        } catch (error) {
            console.warn('Errore nel salvataggio della cache:', error);
        }
    }

    function getCacheInfo() {
        if (!shouldUseCache()) return null;

        const cachedTimestamp = localStorage.getItem(CACHE_TIMESTAMP_KEY);
        if (!cachedTimestamp) return null;

        const cacheAge = Date.now() - parseInt(cachedTimestamp);
        const remainingTime = CACHE_DURATION - cacheAge;

        return {
            age: cacheAge,
            remaining: remainingTime,
            expired: remainingTime <= 0
        };
    }

    // Utilità
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    function findColumnValue(item, possibleColumns) {
        for (const col of possibleColumns) {
            const exactMatch = item[col];
            if (exactMatch) return exactMatch;

            const caseInsensitiveMatch = Object.keys(item).find(key =>
                key.toLowerCase().includes(col.toLowerCase())
            );
            if (caseInsensitiveMatch && item[caseInsensitiveMatch]) {
                return item[caseInsensitiveMatch];
            }
        }
        return null;
    }

    function extractYear(item) {
        const possibleYearFields = ['anno', 'year', 'timestamp', 'Timestamp'];
        for (const field of possibleYearFields) {
            if (item[field]) {
                if (item[field].includes('/') || item[field].includes('-')) {
                    const dateMatch = item[field].match(/(\d{4})/);
                    if (dateMatch) return dateMatch[1];
                } else if (item[field].length === 4 && !isNaN(item[field])) {
                    return item[field];
                }
            }
        }
        return new Date().getFullYear().toString();
    }

    // Funzione per parsare CSV
    function parseCsvLines(strData, strDelimiter) {
        // Check to see if the delimiter is defined. If not,
        // then default to comma.
        strDelimiter = (strDelimiter || ",");

        // Create a regular expression to parse the CSV values.
        var objPattern = new RegExp(
            (
                // Delimiters.
                "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +

                // Quoted fields.
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +

                // Standard fields.
                "([^\"\\" + strDelimiter + "\\r\\n]*))"
            ),
            "gi"
        );


        // Create an array to hold our data. Give the array
        // a default empty first row.
        var arrData = [[]];

        // Create an array to hold our individual pattern
        // matching groups.
        var arrMatches = null;


        // Keep looping over the regular expression matches
        // until we can no longer find a match.
        while (arrMatches = objPattern.exec( strData )){

            // Get the delimiter that was found.
            var strMatchedDelimiter = arrMatches[ 1 ];

            // Check to see if the given delimiter has a length
            // (is not the start of string) and if it matches
            // field delimiter. If id does not, then we know
            // that this delimiter is a row delimiter.
            if (
                strMatchedDelimiter.length &&
                (strMatchedDelimiter != strDelimiter)
            ){

                // Since we have reached a new row of data,
                // add an empty row to our data array.
                arrData.push( [] );

            }


            // Now that we have our delimiter out of the way,
            // let's check to see which kind of value we
            // captured (quoted or unquoted).
            if (arrMatches[ 2 ]){

                // We found a quoted value. When we capture
                // this value, unescape any double quotes.
                var strMatchedValue = arrMatches[ 2 ].replace(
                    new RegExp( "\"\"", "g" ),
                    "\""
                );

            } else {

                // We found a non-quoted value.
                var strMatchedValue = arrMatches[ 3 ];

            }


            // Now that we have our value string, let's add
            // it to the data array.
            arrData[ arrData.length - 1 ].push( strMatchedValue );
        }

        // Return the parsed data.
        return( arrData );
    }


    function parseCSV(csvText) {
        const lines = parseCsvLines(csvText.trim(), ',');

        const headers = lines[0];

        return lines.slice(1).map((values, index) => {
            try {
                const obj = { _rowIndex: index };

                headers.forEach((header, idx) => {
                    obj[header] = values[idx] || '';
                });

                return obj;
            } catch (error) {
                console.warn(`Errore parsing riga ${index + 2}:`, error);
                return null;
            }
        }).filter(row => row && Object.keys(row).length > 3);
    }

    // Caricamento dati con cache
    async function loadData() {
        // Controlla se abbiamo dati in cache validi
        const cachedData = getCachedData();
        if (cachedData) {
            return cachedData;
        }

        // Carica dati freschi dal CSV
        try {
            console.log(`🌐 Caricamento dati freschi dal CSV (${isLocalhost() ? 'localhost' : 'produzione'})`);

            const response = await fetch(CSV_URL);
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const csvText = await response.text();
            if (!csvText.trim()) {
                throw new Error('CSV vuoto o non valido');
            }

            const parsedData = parseCSV(csvText);

            if (parsedData.length === 0) {
                throw new Error('Nessun dato valido trovato nel CSV');
            }

            // Salva nella cache solo se non siamo in localhost
            setCachedData(parsedData);

            console.log(`✅ Caricati ${parsedData.length} record dal CSV`);
            return parsedData;

        } catch (error) {
            console.error('❌ Errore caricamento CSV:', error);

            // Fallback: prova a usare dati dalla cache anche se scaduti
            if (shouldUseCache()) {
                const expiredCache = localStorage.getItem(CACHE_KEY);
                if (expiredCache) {
                    console.warn('⚠️ Utilizzando cache scaduta come fallback');
                    return JSON.parse(expiredCache);
                }
            }

            throw error;
        }
    }

    // Sistema di filtri
    function setupFilters(data) {
        const years = [...new Set(data.map(extractYear))].sort();
        populateSelect('yearFilter', years, 'all', '🌐 Tutti gli anni');

        const roles = [...new Set(data.map(item => findColumnValue(item, ['ruolo', 'role', 'position'])).filter(Boolean))];
        populateSelect('roleFilter', roles, 'all', '👥 Tutti i ruoli');

        const experiences = [...new Set(data.map(item => findColumnValue(item, ['esperienza', 'experience', 'anni'])).filter(Boolean))];
        populateSelect('experienceFilter', experiences, 'all', '⏱️ Tutti i livelli');

        ['yearFilter', 'roleFilter', 'experienceFilter', 'searchFilter'].forEach(filterId => {
            document.getElementById(filterId).addEventListener('change', handleFilterChange);
            if (filterId === 'searchFilter') {
                document.getElementById(filterId).addEventListener('input', debounce(handleFilterChange, 300));
            }
        });
    }

    function populateSelect(selectId, options, defaultValue, defaultText) {
        const select = document.getElementById(selectId);
        select.innerHTML = `<option value="${defaultValue}">${defaultText}</option>`;

        options.forEach(option => {
            if (option) {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                select.appendChild(optionElement);
            }
        });
    }

    function handleFilterChange() {
        currentFilters = {
            year: document.getElementById('yearFilter').value,
            role: document.getElementById('roleFilter').value,
            experience: document.getElementById('experienceFilter').value,
            search: document.getElementById('searchFilter').value.toLowerCase().trim()
        };

        filteredData = applyFilters(allData, currentFilters);
        const analysis = analyzeData(filteredData);

        updateDashboard(analysis);
    }

    function applyFilters(data, filters) {
        return data.filter(item => {
            if (filters.year !== 'all' && extractYear(item) !== filters.year) {
                return false;
            }

            if (filters.role !== 'all') {
                const role = findColumnValue(item, ['ruolo', 'role', 'position']);
                if (role !== filters.role) return false;
            }

            if (filters.experience !== 'all') {
                const exp = findColumnValue(item, ['esperienza', 'experience', 'anni']);
                if (exp !== filters.experience) return false;
            }

            if (filters.search) {
                const searchText = Object.values(item).join(' ').toLowerCase();
                if (!searchText.includes(filters.search)) return false;
            }

            return true;
        });
    }

    // Analisi dati
    function analyzeData(data) {
        console.log("Analizzando dati:", data);
        const totalResponses = data.length;

        if (totalResponses === 0) {
            return {
                totalResponses: 0,
                avgSatisfaction: '0',
                devexAwareness: '0',
                companyInvestment: '0',
                roleCounts: {},
                expCounts: {},
                devexCounts: {},
                investmentCounts: {},
                satisfactionByRole: {}
            };
        }

        // Trova dinamicamente i nomi delle colonne
        const sampleRow = data[0];
        const columns = Object.keys(sampleRow);

        const roleColumn = columns.find(col =>
            col.toLowerCase().includes('ruolo') ||
            col.toLowerCase().includes('role') ||
            col.toLowerCase().includes('position')
        );

        const experienceColumn = columns.find(col =>
            col.toLowerCase().includes('esperienza') ||
            col.toLowerCase().includes('experience') ||
            col.toLowerCase().includes('anni')
        );

        const satisfactionColumn = columns.find(col =>
            col.toLowerCase().includes('soddisfatto') ||
            col.toLowerCase().includes('satisfaction') ||
            col.toLowerCase().includes('strumenti')
        );

        console.log("SAT", satisfactionColumn)

        const devexColumn = columns.find(col =>
            col.toLowerCase().includes('devex') ||
            col.toLowerCase().includes('developer experience') ||
            col.toLowerCase().includes('sentito parlare')
        );

        const investmentColumn = columns.find(col =>
            col.toLowerCase().includes('azienda') ||
            col.toLowerCase().includes('investe') ||
            col.toLowerCase().includes('company') ||
            col.toLowerCase().includes('programmi')
        );

        // Calcola statistiche
        let totalSatisfaction = 0;
        let satisfactionCount = 0;
        let devexAware = 0;
        let companyInvesting = 0;

        const roleCounts = {};
        const expCounts = {};
        const devexCounts = {};
        const investmentCounts = {};
        const satisfactionByRole = {};
        const satisfactionCounts = {};

        data.forEach(item => {
            // Soddisfazione
            console.log("ITEM:", item)
            if (satisfactionColumn && item[satisfactionColumn]) {

                const satisfaction = parseInt(item[satisfactionColumn]);
                if (!isNaN(satisfaction)) {
                    totalSatisfaction += satisfaction;
                    satisfactionCount++;
                    satisfactionCounts[satisfaction] = (satisfactionCounts[satisfaction] || 0) + 1;

                    // Soddisfazione per ruolo
                    const role = findColumnValue(item, ['ruolo', 'role', 'position']);
                    if (role) {
                        if (!satisfactionByRole[role]) {
                            satisfactionByRole[role] = { total: 0, count: 0 };
                        }
                        satisfactionByRole[role].total += satisfaction;
                        satisfactionByRole[role].count++;
                    }
                }
            }

            // Ruoli
            const role = findColumnValue(item, ['ruolo', 'role', 'position']);
            if (role) {
                roleCounts[role] = (roleCounts[role] || 0) + 1;
            }

            // Esperienza
            const experience = findColumnValue(item, ['esperienza', 'experience', 'anni']);
            if (experience) {
                expCounts[experience] = (expCounts[experience] || 0) + 1;
            }

            // Conoscenza DevEx
            const devexResponse = findColumnValue(item, ['devex', 'developer experience', 'sentito parlare']);
            if (devexResponse) {
                devexCounts[devexResponse] = (devexCounts[devexResponse] || 0) + 1;

                if (devexResponse.toLowerCase().includes('conosco') ||
                    devexResponse.toLowerCase().includes('sentito parlare') ||
                    devexResponse.toLowerCase().includes('sì')) {
                    devexAware++;
                }
            }

            // Investimento aziendale
            const investmentResponse = findColumnValue(item, ['azienda', 'investe', 'company', 'programmi']);
            if (investmentResponse) {
                investmentCounts[investmentResponse] = (investmentCounts[investmentResponse] || 0) + 1;

                if (investmentResponse.toLowerCase().includes('sì') ||
                    investmentResponse.toLowerCase().includes('programmi') ||
                    investmentResponse.toLowerCase().includes('dedicato')) {
                    companyInvesting++;
                }
            }
        });

        const avgSatisfaction = satisfactionCount > 0 ?
            (totalSatisfaction / satisfactionCount).toFixed(1) : '0';
        const devexAwareness = totalResponses > 0 ?
            ((devexAware / totalResponses) * 100).toFixed(0) : '0';
        const companyInvestment = totalResponses > 0 ?
            ((companyInvesting / totalResponses) * 100).toFixed(0) : '0';

        return {
            totalResponses,
            avgSatisfaction,
            devexAwareness,
            companyInvestment,
            roleCounts,
            expCounts,
            devexCounts,
            investmentCounts,
            satisfactionByRole,
            satisfactionCounts
        };
    }

    // Aggiornamento dashboard
    function updateDashboard(analysis) {
        updateStats(analysis);
        createCharts(analysis);
        createInsights(analysis);
        createSummary(analysis);
    }

    function updateStats(analysis) {
        document.getElementById('totalResponses').textContent = analysis.totalResponses;
        document.getElementById('avgSatisfaction').textContent = analysis.avgSatisfaction + '/5';
        document.getElementById('devexAwareness').textContent = analysis.devexAwareness + '%';
        document.getElementById('companyInvestment').textContent = analysis.companyInvestment + '%';
    }

    // Creazione grafici
    function createCharts(analysis) {
        // Grafico distribuzione ruoli
        if (Object.keys(analysis.roleCounts).length > 0) {
            const roleData = Object.entries(analysis.roleCounts);
            createChart('roleChart', {
                type: 'doughnut',
                data: {
                    labels: roleData.map(([role]) => role),
                    datasets: [{
                        data: roleData.map(([, count]) => count),
                        backgroundColor: colors,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // Grafico distribuzione esperienza
        if (Object.keys(analysis.expCounts).length > 0) {
            const expData = Object.entries(analysis.expCounts);
            createChart('experienceChart', {
                type: 'bar',
                data: {
                    labels: expData.map(([exp]) => exp),
                    datasets: [{
                        data: expData.map(([, count]) => count),
                        backgroundColor: colors[0],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Grafico soddisfazione
        if (Object.keys(analysis.satisfactionCounts).length > 0) {
            const satisfactionData = Object.entries(analysis.satisfactionCounts).sort(([a], [b]) => a - b);
            createChart('satisfactionChart', {
                type: 'bar',
                data: {
                    labels: satisfactionData.map(([level]) => `Livello ${level}`),
                    datasets: [{
                        data: satisfactionData.map(([, count]) => count),
                        backgroundColor: colors[1],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Grafico conoscenza DevEx
        if (Object.keys(analysis.devexCounts).length > 0) {
            const devexData = Object.entries(analysis.devexCounts);
            createChart('devexKnowledgeChart', {
                type: 'pie',
                data: {
                    labels: devexData.map(([knowledge]) => knowledge.substring(0, 30) + '...'),
                    datasets: [{
                        data: devexData.map(([, count]) => count),
                        backgroundColor: [colors[1], colors[2], colors[3]],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }

        // Grafico soddisfazione per ruolo
        if (Object.keys(analysis.satisfactionByRole).length > 0) {
            const roleAvgData = Object.entries(analysis.satisfactionByRole)
                .map(([role, data]) => ({
                    role,
                    avg: (data.total / data.count).toFixed(1)
                }));

            createChart('satisfactionByRoleChart', {
                type: 'bar',
                data: {
                    labels: roleAvgData.map(item => item.role),
                    datasets: [{
                        data: roleAvgData.map(item => parseFloat(item.avg)),
                        backgroundColor: colors[2],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: 5 } }
                }
            });
        }

        // Grafico investimento aziendale
        if (Object.keys(analysis.investmentCounts).length > 0) {
            const investmentData = Object.entries(analysis.investmentCounts);
            createChart('companyInvestmentChart', {
                type: 'bar',
                data: {
                    labels: investmentData.map(([investment]) => investment.substring(0, 25) + '...'),
                    datasets: [{
                        data: investmentData.map(([, count]) => count),
                        backgroundColor: colors[4],
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
        }

        // Grafico trend annuale
        createYearlyTrend();
    }

    function createYearlyTrend() {
        const yearlyData = {};
        const sampleRow = allData[0];
        const columns = Object.keys(sampleRow);

        const satisfactionColumn = columns.find(col =>
            col.toLowerCase().includes('soddisfatto') ||
            col.toLowerCase().includes('satisfaction') ||
            col.toLowerCase().includes('strumenti')
        );

        allData.forEach(item => {
            const year = extractYear(item);

            if (!yearlyData[year]) {
                yearlyData[year] = { total: 0, count: 0 };
            }

            if (satisfactionColumn && item[satisfactionColumn]) {
                const satisfaction = parseInt(item[satisfactionColumn]);
                if (!isNaN(satisfaction)) {
                    yearlyData[year].total += satisfaction;
                    yearlyData[year].count++;
                }
            }
        });

        const yearlyTrendData = Object.entries(yearlyData)
            .sort(([a], [b]) => a.localeCompare(b))
            .map(([year, data]) => ({
                year,
                avgSatisfaction: data.count > 0 ? (data.total / data.count).toFixed(1) : '0',
                responses: data.count
            }));

        if (yearlyTrendData.length > 0) {
            createChart('yearlyTrendChart', {
                type: 'line',
                data: {
                    labels: yearlyTrendData.map(item => item.year),
                    datasets: [
                        {
                            label: 'Soddisfazione Media',
                            data: yearlyTrendData.map(item => parseFloat(item.avgSatisfaction)),
                            borderColor: colors[3],
                            backgroundColor: colors[3] + '20',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Numero Risposte',
                            data: yearlyTrendData.map(item => item.responses),
                            borderColor: colors[4],
                            backgroundColor: colors[4] + '20',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true,
                            max: 5,
                            title: { display: true, text: 'Soddisfazione Media' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            title: { display: true, text: 'Numero Risposte' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });
        }
    }

    function createChart(canvasId, config) {
        const ctx = document.getElementById(canvasId)?.getContext('2d');
        if (!ctx) return;

        if (chartInstances[canvasId]) {
            chartInstances[canvasId].destroy();
        }
        chartInstances[canvasId] = new Chart(ctx, config);
    }

    // Insights automatici
    function createInsights(analysis) {
        const insights = [];

        // Insight soddisfazione
        if (parseFloat(analysis.avgSatisfaction) > 4) {
            insights.push({
                value: '🎯 Eccellente',
                label: 'Soddisfazione generale alta'
            });
        } else if (parseFloat(analysis.avgSatisfaction) < 3) {
            insights.push({
                value: '⚠️ Critica',
                label: 'Soddisfazione sotto la media'
            });
        }

        // Insight team composition
        const topRole = Object.entries(analysis.roleCounts)
            .sort(([,a], [,b]) => b - a)[0];
        if (topRole) {
            insights.push({
                value: topRole[0],
                label: `Ruolo più rappresentato (${topRole[1]} risposte)`
            });
        }

        // Insight DevEx awareness
        if (parseInt(analysis.devexAwareness) > 70) {
            insights.push({
                value: '📈 Alta',
                label: 'Consapevolezza DevEx elevata'
            });
        } else if (parseInt(analysis.devexAwareness) < 30) {
            insights.push({
                value: '📉 Bassa',
                label: 'Opportunità di formazione'
            });
        }

        // Insight investimenti
        if (parseInt(analysis.companyInvestment) > 50) {
            insights.push({
                value: '💰 Buono',
                label: '50%+ aziende investe in DevEx'
            });
        }

        const insightsContainer = document.getElementById('insightsContainer');
        insightsContainer.innerHTML = insights.map(insight => `
                <div class="insight-card">
                    <div class="insight-value">${insight.value}</div>
                    <div class="insight-label">${insight.label}</div>
                </div>
            `).join('');
    }

    // Sintesi esecutiva
    function createSummary(analysis) {
        const summaryContent = document.getElementById('summaryContent');

        if (analysis.totalResponses === 0) {
            summaryContent.innerHTML = '<div class="summary-item"><h3>📊 Nessun dato disponibile</h3><p>Non ci sono dati per il filtro selezionato.</p></div>';
            return;
        }

        const highSatisfaction = Object.entries(analysis.satisfactionCounts)
            .filter(([level]) => parseInt(level) >= 4)
            .reduce((sum, [, count]) => sum + count, 0);
        const highSatisfactionPerc = ((highSatisfaction / analysis.totalResponses) * 100).toFixed(1);

        const lowSatisfaction = Object.entries(analysis.satisfactionCounts)
            .filter(([level]) => parseInt(level) <= 2)
            .reduce((sum, [, count]) => sum + count, 0);
        const lowSatisfactionPerc = ((lowSatisfaction / analysis.totalResponses) * 100).toFixed(1);

        const currentYear = document.getElementById('yearFilter').value;
        const yearText = currentYear === 'all' ? 'tutti gli anni' : `l'anno ${currentYear}`;

        const topRole = Object.entries(analysis.roleCounts)
            .sort(([,a], [,b]) => b - a)[0];

        const topExperience = Object.entries(analysis.expCounts)
            .sort(([,a], [,b]) => b - a)[0];

        const devexAwarenessLevel = parseInt(analysis.devexAwareness);
        let awarenessStatus = 'Media';
        if (devexAwarenessLevel > 70) awarenessStatus = 'Elevata';
        else if (devexAwarenessLevel < 30) awarenessStatus = 'Bassa';

        const investmentLevel = parseInt(analysis.companyInvestment);
        let investmentStatus = 'Moderato';
        if (investmentLevel > 60) investmentStatus = 'Elevato';
        else if (investmentLevel < 30) investmentStatus = 'Limitato';

        summaryContent.innerHTML = `
                <div class="summary-item">
                    <h3>🎯 Soddisfazione Generale</h3>
                    <p>${highSatisfactionPerc}% degli sviluppatori è soddisfatto o molto soddisfatto degli strumenti attuali per ${yearText} (punteggio 4-5). Media complessiva: ${analysis.avgSatisfaction}/5.</p>
                </div>
                <div class="summary-item">
                    <h3>⚠️ Aree di Miglioramento</h3>
                    <p>${lowSatisfactionPerc}% degli sviluppatori esprime insoddisfazione (punteggio 1-2). Questi casi richiedono attenzione immediata per identificare le criticità.</p>
                </div>
                <div class="summary-item">
                    <h3>👥 Composizione del Team</h3>
                    <p>Il ruolo più rappresentato è "${topRole?.[0] || 'N/A'}" con ${topRole?.[1] || 0} risposte. Distribuzione: ${Object.keys(analysis.roleCounts).length} ruoli diversi nel campione.</p>
                </div>
                <div class="summary-item">
                    <h3>🎓 Livello di Esperienza</h3>
                    <p>Fascia più rappresentata: "${topExperience?.[0] || 'N/A'}" con ${topExperience?.[1] || 0} risposte. Diversità: ${Object.keys(analysis.expCounts).length} livelli di esperienza mappati.</p>
                </div>
                <div class="summary-item">
                    <h3>🧠 Consapevolezza DevEx</h3>
                    <p>Livello di awareness: ${awarenessStatus} (${analysis.devexAwareness}%). La conoscenza del concetto Developer Experience è un fattore chiave per l'adozione di best practice.</p>
                </div>
                <div class="summary-item">
                    <h3>💼 Investimenti Aziendali</h3>
                    <p>Livello di investimento: ${investmentStatus} (${analysis.companyInvestment}%). Le aziende con programmi strutturati mostrano generalmente maggiore soddisfazione degli sviluppatori.</p>
                </div>
            `;
    }

    // Funzioni di export rimosse - mantenute solo quelle per i grafici
    function downloadChart(chartId) {
        const chart = chartInstances[chartId];
        if (chart) {
            const url = chart.toBase64Image();
            const a = document.createElement('a');
            a.href = url;
            a.download = `${chartId}_chart.png`;
            a.click();
        }
    }

    function toggleChartType(chartId) {
        // Implementazione per cambiare tipo di grafico
        console.log(`Toggle chart type for ${chartId}`);
    }

    // Funzione principale con gestione cache
    async function initDashboard() {
        try {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('error').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';

            // Mostra info cache nel loading se applicabile
            updateLoadingMessage();

            allData = await loadData();
            filteredData = [...allData];

            setupFilters(allData);

            const analysis = analyzeData(filteredData);

            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';

            updateDashboard(analysis);

            // Mostra info cache nella console se applicabile
            logCacheStatus();

        } catch (error) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
            console.error('Errore nel caricamento:', error);
        }
    }

    function updateLoadingMessage() {
        const loadingDiv = document.getElementById('loading');
        const cacheInfo = getCacheInfo();

        if (shouldUseCache() && cacheInfo && !cacheInfo.expired) {
            const remainingMinutes = Math.ceil(cacheInfo.remaining / (60 * 1000));
            loadingDiv.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div>Caricamento dati dal Google Sheets...</div>
                    <div style="font-size: 0.9rem; opacity: 0.7;">
                        Cache disponibile - prossimo aggiornamento tra ${remainingMinutes} min
                    </div>
                `;
        } else if (isLocalhost()) {
            loadingDiv.innerHTML = `
                    <div class="loading-spinner"></div>
                    <div>Caricamento dati dal Google Sheets...</div>
                    <div style="font-size: 0.9rem; opacity: 0.7;">
                        Modalità sviluppo - dati sempre freschi
                    </div>
                `;
        }
    }

    function logCacheStatus() {
        if (shouldUseCache()) {
            const cacheInfo = getCacheInfo();
            if (cacheInfo) {
                const ageMinutes = Math.floor(cacheInfo.age / (60 * 1000));
                const remainingMinutes = Math.ceil(cacheInfo.remaining / (60 * 1000));
                console.log(`📊 Cache status: età ${ageMinutes}m, prossimo refresh tra ${remainingMinutes}m`);
            }
        } else {
            console.log(`🔧 Modalità sviluppo: cache disabilitata`);
        }
    }

    // Avvia l'applicazione
    initDashboard();

    // Aggiorna periodicamente
    // In localhost: ogni 5 minuti (per sviluppo)
    // In produzione: ogni 10 minuti (rispetta la cache)
    const refreshInterval = isLocalhost() ? 5 * 60 * 1000 : CACHE_DURATION;
    setInterval(() => {
        console.log(`🔄 Refresh automatico (intervallo: ${refreshInterval / 60000}m)`);
        initDashboard();
    }, refreshInterval);
</script>
</body>
</html>
